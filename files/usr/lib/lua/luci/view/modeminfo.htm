<%+header%>
<h1>Modem Information</h1>
<p style="display: flex; align-items: center;">
    If you like my work, please consider supporting me:
    <!-- GitHub Star -->
    <img id="star" src="/luci-static/resources/modeminfo/Star.svg"
         loading="lazy" alt="Star" width="50px" height="20px"
         style="margin-left: 10px;"
         onerror="return imgerrorfuns(this,'https://img.shields.io/badge/Star--lightgrey?logo=github&style=social')"
         onclick="window.open('https://github.com/solomonricky/luci-app-modeminfo', '_blank')">
    <!-- Buy Me a Coffee -->
    <img id="sponsor" src="/luci-static/resources/modeminfo/Sponsor.svg"
         loading="lazy" alt="Sponsor" width="73px" height="20px"
         style="margin-left: 10px;"
         onerror="return imgerrorfuns(this,'https://img.shields.io/badge/Sponsor--lightgrey?logo=ko-fi&style=social')"
         onclick="window.open('https://buymeacoffee.com/solomonricky', '_blank')">
    <!-- Telegram -->
    <img id="telegram" src="/luci-static/resources/modeminfo/Telegram.svg"
         loading="lazy" alt="Telegram"
         style="margin-left: 10px;"
         onerror="return imgerrorfuns(this,'https://img.shields.io/badge/Telegram--lightgrey?logo=Telegram&style=social')"
         onclick="window.open('https://t.me/myopenwrt', '_blank')">
</p>
</br>

<h2>General Information</h2>
<table class="table" style="border-spacing: 10px 20px;">
<tr><td><strong>Modem:</strong></td><td id="modem">Loading...</td></tr>
<tr><td><strong>IMEI:</strong></td><td id="imei">Loading...</td></tr>
<tr><td><strong>Temperature:</strong></td><td id="temperature">Loading...</td></tr>
<tr><td><strong>ISP:</strong></td><td id="isp">Loading...</td></tr>
<tr><td><strong>Protocol:</strong></td><td id="protocol">Loading...</td></tr>
<tr><td><strong>Firmware Version:</strong></td><td id="revision">Loading...</td></tr>
</table>
</br>

<h2>Signal Information</h2>
<table class="table" style="border-spacing: 10px 20px;">
<tr><td><strong>Network:</strong></td><td id="network">Loading...</td></tr>
<tr><td><strong>CSQ:</strong></td><td id="csq">Loading...</td></tr>
<tr><td><strong>Signal Strength:</strong></td>
<td id="signal-strength">
  <div id="signal-progress" class="progress-bar">
    <div class="progress-bar-inner"></div>
    <div id="signal-progress-value" class="progress-value">Loading...</div>
  </div>
</td></tr>
<tr><td><strong>RSSI:</strong></td>
<td id="rssi">
  <div id="rssi-progress" class="progress-bar">
    <div class="progress-bar-inner"></div>
    <div id="rssi-progress-value" class="progress-value">Loading...</div>
  </div>
</td></tr>
<tr><td><strong>LTE RSRQ:</strong></td>
<td id="rsrq-4g">
  <div id="lte-rsrq-progress" class="progress-bar">
    <div class="progress-bar-inner"></div>
    <div id="lte-rsrq-progress-value" class="progress-value">Loading...</div>
  </div>
</td></tr>
<tr><td><strong>LTE RSRP:</strong></td>
<td id="lte-rsrp">
  <div id="lte-rsrp-progress" class="progress-bar">
    <div class="progress-bar-inner"></div>
    <div id="lte-rsrp-progress-value" class="progress-value">Loading...</div>
  </div>
</td></tr>
<tr><td><strong>LTE SINR:</strong></td>
<td id="lte-sinr">
  <div id="lte-sinr-progress" class="progress-bar">
    <div class="progress-bar-inner"></div>
    <div id="lte-sinr-progress-value" class="progress-value">Loading...</div>
  </div>
</td></tr>

<!-- NSA -->
<tr><td colspan="2"><strong>NR5G-NSA</strong></td></tr>
<tr><td><strong>RSRQ:</strong></td>
<td><div id="nr5g-nsa-rsrq-progress" class="progress-bar">
    <div class="progress-bar-inner"></div>
    <div id="nr5g-nsa-rsrq-progress-value" class="progress-value">Loading...</div>
</div></td></tr>
<tr><td><strong>RSRP:</strong></td>
<td><div id="nr5g-nsa-rsrp-progress" class="progress-bar">
    <div class="progress-bar-inner"></div>
    <div id="nr5g-nsa-rsrp-progress-value" class="progress-value">Loading...</div>
</div></td></tr>
<tr><td><strong>SINR:</strong></td>
<td><div id="nr5g-nsa-sinr-progress" class="progress-bar">
    <div class="progress-bar-inner"></div>
    <div id="nr5g-nsa-sinr-progress-value" class="progress-value">Loading...</div>
</div></td></tr>

<!-- SA -->
<tr><td colspan="2"><strong>NR5G-SA</strong></td></tr>
<tr><td><strong>RSRQ:</strong></td>
<td><div id="nr5g-sa-rsrq-progress" class="progress-bar">
    <div class="progress-bar-inner"></div>
    <div id="nr5g-sa-rsrq-progress-value" class="progress-value">Loading...</div>
</div></td></tr>
<tr><td><strong>RSRP:</strong></td>
<td><div id="nr5g-sa-rsrp-progress" class="progress-bar">
    <div class="progress-bar-inner"></div>
    <div id="nr5g-sa-rsrp-progress-value" class="progress-value">Loading...</div>
</div></td></tr>
<tr><td><strong>SINR:</strong></td>
<td><div id="nr5g-sa-sinr-progress" class="progress-bar">
    <div class="progress-bar-inner"></div>
    <div id="nr5g-sa-sinr-progress-value" class="progress-value">Loading...</div>
</div></td></tr>
</table>
</br>

<h2>Cell Information</h2>
<table class="table" style="border-spacing: 10px 20px;">
<tr><td><strong>LTE MCC/MNC:</strong></td><td><span id="mcc">-</span>/<span id="mnc">-</span></td></tr>
<tr><td><strong>LTE Cell ID:</strong></td><td><span id="cellid">-</span> (<span id="deccellid">-</span>)</td></tr>
<tr><td><strong>NR5G-SA MCC/MNC:</strong></td><td><span id="nr5g-sa-mcc">-</span>/<span id="nr5g-sa-mnc">-</span></td></tr>
<tr><td><strong>NR5G-SA Cell ID:</strong></td><td><span id="nr5g-sa-cellid">-</span> (<span id="nr5g-sa-deccellid">-</span>)</td></tr>
<tr><td><strong>PCC:</strong></td><td id="pcc">-</td></tr>
</table>
</br>

<script>
function calcPct(v,min,max){return Math.max(0,Math.min(100,((v-min)/(max-min))*100));}
function updateBar(el,valEl,v,min,max){
 const bar=document.querySelector("#"+el+" .progress-bar-inner");
 const txt=document.getElementById(valEl);
 if(isNaN(v)||v===null){bar.style.width='0%';txt.innerText="No Signal";return;}
 const pct=calcPct(v,min,max);
 bar.style.width=pct+"%";txt.innerText=v+" dB";
}

function updateModemInfo(){
 fetch('<%=luci.dispatcher.build_url("admin/modem/modeminfo/get_info")%>')
 .then(r=>r.json()).then(d=>{
   document.getElementById('modem').innerText=d["Modem"]||"-";
   document.getElementById('imei').innerText=d["IMEI"]||"-";
   document.getElementById('isp').innerText=d["ISP"]||"-";
   document.getElementById('revision').innerText=d["Revision"]||"-";
   document.getElementById('protocol').innerText=d["Protocol"]||"-";
   document.getElementById('temperature').innerText=d["Temperature"]||"-";
   document.getElementById('network').innerText=d["Network"]||"-";
   document.getElementById('csq').innerText=d["CSQ"]||"-";
   document.getElementById('mcc').innerText=d["LTE MCC"]||"-";
   document.getElementById('mnc').innerText=d["LTE MNC"]||"-";
   document.getElementById('cellid').innerText=d["LTE Cell ID"]||"-";
   document.getElementById('deccellid').innerText=d["LTE Cell ID (Dec)"]||"-";
   document.getElementById('nr5g-sa-mcc').innerText=d["NR5G-SA MCC"]||"-";
   document.getElementById('nr5g-sa-mnc').innerText=d["NR5G-SA MNC"]||"-";
   document.getElementById('nr5g-sa-cellid').innerText=d["NR5G-SA Cell ID"]||"-";
   document.getElementById('nr5g-sa-deccellid').innerText=d["NR5G-SA Cell ID (Dec)"]||"-";
   document.getElementById('pcc').innerText=d["PCC"]||"-";

   updateBar("lte-rsrq-progress","lte-rsrq-progress-value",parseFloat(d["LTE RSRQ"]),-20,3);
   updateBar("lte-rsrp-progress","lte-rsrp-progress-value",parseFloat(d["LTE RSRP"]),-140,-44);
   updateBar("lte-sinr-progress","lte-sinr-progress-value",parseFloat(d["LTE SINR"]),-20,30);
   updateBar("nr5g-nsa-rsrq-progress","nr5g-nsa-rsrq-progress-value",parseFloat(d["NR5G-NSA RSRQ"]),-20,3);
   updateBar("nr5g-nsa-rsrp-progress","nr5g-nsa-rsrp-progress-value",parseFloat(d["NR5G-NSA RSRP"]),-140,-44);
   updateBar("nr5g-nsa-sinr-progress","nr5g-nsa-sinr-progress-value",parseFloat(d["NR5G-NSA SINR"]),-20,30);
   updateBar("nr5g-sa-rsrq-progress","nr5g-sa-rsrq-progress-value",parseFloat(d["NR5G-SA RSRQ"]),-20,3);
   updateBar("nr5g-sa-rsrp-progress","nr5g-sa-rsrp-progress-value",parseFloat(d["NR5G-SA RSRP"]),-140,-44);
   updateBar("nr5g-sa-sinr-progress","nr5g-sa-sinr-progress-value",parseFloat(d["NR5G-SA SINR"]),-20,30);
 })
}
setInterval(updateModemInfo,5000);
updateModemInfo();
</script>

<style>
.progress-bar{width:100%;background:#ddd;height:20px;border-radius:20px;position:relative;}
.progress-bar-inner{height:100%;background:lime;transition:width .4s;}
.progress-value{position:absolute;left:50%;transform:translateX(-50%);font-weight:bold;line-height:20px;}
</style>
<%+footer%>
