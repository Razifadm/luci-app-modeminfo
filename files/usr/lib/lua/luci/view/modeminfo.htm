<%+header%>
<h1>Modem Information</h1>
<p style="display: flex; align-items: center;">
    If you like my work, please consider supporting me:
    <img id="star" src="/luci-static/resources/modeminfo/Star.svg?654407727g" loading="lazy" alt="Star" width="50px" height="20px" style="margin-left: 10px;" onclick="window.open('https://github.com/solomonricky/luci-app-modeminfo', '_blank')">
    <img id="sponsor" src="/luci-static/resources/modeminfo/Sponsor.svg?308407727" loading="lazy" alt="Sponsor" width="73px" height="20px" style="margin-left: 10px;" onclick="window.open('https://buymeacoffee.com/solomonricky', '_blank')">
    <img id="telegram" src="/luci-static/resources/modeminfo/Telegram.svg?308407727" loading="lazy" alt="Telegram" style="margin-left: 10px;" onclick="window.open('https://t.me/myopenwrt', '_blank')">
</p>
</br>

<h2>General Information</h2>
<table class="table" style="border-spacing: 10px 20px;">
  <tr><td><strong>Modem:</strong></td><td id="modem">Loading...</td></tr>
  <tr><td><strong>IMEI:</strong></td><td id="imei">Loading...</td></tr>
  <tr><td><strong>Temperature:</strong></td><td id="temperature">Loading...</td></tr>
  <tr><td><strong>ISP:</strong></td><td id="isp">Loading...</td></tr>
  <tr><td><strong>Protocol:</strong></td><td id="protocol">Loading...</td></tr>
  <tr><td><strong>Firmware Version:</strong></td><td id="revision">Loading...</td></tr>
</table>
</br>

<h2>Signal Information</h2>
<table class="table" style="border-spacing: 10px 20px;">
  <tr><td><strong>Network:</strong></td><td id="network">Loading...</td></tr>
  <tr><td><strong>CSQ:</strong></td><td id="csq">Loading...</td></tr>
  <tr><td><strong>Signal Strength:</strong></td>
      <td><div id="signal-progress" class="progress-bar"><div class="progress-bar-inner"></div><div id="signal-progress-value" class="progress-value">Loading...</div></div></td></tr>
  <tr><td><strong>RSSI:</strong></td>
      <td><div id="rssi-progress" class="progress-bar"><div class="progress-bar-inner"></div><div id="rssi-progress-value" class="progress-value">Loading...</div></div></td></tr>
  <tr><td><strong>LTE RSRQ:</strong></td>
      <td><div id="lte-rsrq-progress" class="progress-bar"><div class="progress-bar-inner"></div><div id="lte-rsrq-progress-value" class="progress-value">Loading...</div></div></td></tr>
  <tr><td><strong>LTE RSRP:</strong></td>
      <td><div id="lte-rsrp-progress" class="progress-bar"><div class="progress-bar-inner"></div><div id="lte-rsrp-progress-value" class="progress-value">Loading...</div></div></td></tr>
  <tr><td><strong>LTE SINR:</strong></td>
      <td><div id="lte-sinr-progress" class="progress-bar"><div class="progress-bar-inner"></div><div id="lte-sinr-progress-value" class="progress-value">Loading...</div></div></td></tr>

  <!-- NR5G-NSA -->
  <tr><td colspan="2"><strong>NR5G-NSA</strong></td></tr>
  <tr><td><strong>RSRQ:</strong></td>
      <td><div id="nr5g-nsa-rsrq" class="progress-bar"><div class="progress-bar-inner"></div><div id="nr5g-nsa-rsrq-value" class="progress-value">Loading...</div></div></td></tr>
  <tr><td><strong>RSRP:</strong></td>
      <td><div id="nr5g-nsa-rsrp" class="progress-bar"><div class="progress-bar-inner"></div><div id="nr5g-nsa-rsrp-value" class="progress-value">Loading...</div></div></td></tr>
  <tr><td><strong>SINR:</strong></td>
      <td><div id="nr5g-nsa-sinr" class="progress-bar"><div class="progress-bar-inner"></div><div id="nr5g-nsa-sinr-value" class="progress-value">Loading...</div></div></td></tr>

  <!-- NR5G-SA -->
  <tr><td colspan="2"><strong>NR5G-SA</strong></td></tr>
  <tr><td><strong>RSRQ:</strong></td>
      <td><div id="nr5g-sa-rsrq" class="progress-bar"><div class="progress-bar-inner"></div><div id="nr5g-sa-rsrq-value" class="progress-value">Loading...</div></div></td></tr>
  <tr><td><strong>RSRP:</strong></td>
      <td><div id="nr5g-sa-rsrp" class="progress-bar"><div class="progress-bar-inner"></div><div id="nr5g-sa-rsrp-value" class="progress-value">Loading...</div></div></td></tr>
  <tr><td><strong>SINR:</strong></td>
      <td><div id="nr5g-sa-sinr" class="progress-bar"><div class="progress-bar-inner"></div><div id="nr5g-sa-sinr-value" class="progress-value">Loading...</div></div></td></tr>
</table>
</br>

<h2>Cell Information</h2>
<table class="table" style="border-spacing: 10px 20px;">
  <tr><td><strong>LTE MCC/MNC:</strong></td><td><span id="mcc">Loading...</span> <span id="mnc">Loading...</span></td></tr>
  <tr><td><strong>LTE Cell ID:</strong></td><td><span id="cellid">Loading...</span> (<span id="deccellid">Loading...</span>)</td></tr>
  <tr><td><strong>NR5G-SA MCC/MNC:</strong></td><td><span id="nr5g-sa-mcc">Loading...</span> <span id="nr5g-sa-mnc">Loading...</span></td></tr>
  <tr><td><strong>NR5G-SA Cell ID:</strong></td><td><span id="nr5g-sa-cellid">Loading...</span> (<span id="nr5g-sa-deccellid">Loading...</span>)</td></tr>
  <tr><td><strong>PCC:</strong></td><td id="pcc">Loading...</td></tr>
</table>
</br>

<script>
function updateProgressBar(id, value, min, max) {
  const bar = document.querySelector(`#${id} .progress-bar-inner`);
  const txt = document.querySelector(`#${id}-value`);
  if (!value || value === "No Signal") {
    bar.style.width = "0%"; txt.innerText = "No Signal"; return;
  }
  let v = parseFloat(value);
  let per = ((v - min) / (max - min)) * 100;
  per = Math.max(0, Math.min(100, per));
  bar.style.width = per + "%";
  txt.innerText = v + " dB";
}
function updateModemInfo() {
  fetch('<%=luci.dispatcher.build_url("admin/modem/modeminfo/get_info")%>')
  .then(r=>r.json()).then(data=>{
    document.getElementById("modem").innerText = data["Modem"];
    document.getElementById("imei").innerText = data["IMEI"];
    document.getElementById("isp").innerText = data["ISP"];
    document.getElementById("revision").innerText = data["Revision"];
    document.getElementById("protocol").innerText = data["Protocol"];
    document.getElementById("temperature").innerText = data["Temperature"];
    document.getElementById("network").innerText = data["Network"];
    document.getElementById("csq").innerText = data["CSQ"];
    document.getElementById("mcc").innerText = data["LTE MCC"];
    document.getElementById("mnc").innerText = data["LTE MNC"];
    document.getElementById("cellid").innerText = data["LTE Cell ID"];
    document.getElementById("deccellid").innerText = data["LTE Cell ID (Dec)"];
    document.getElementById("nr5g-sa-mcc").innerText = data["NR5G-SA MCC"];
    document.getElementById("nr5g-sa-mnc").innerText = data["NR5G-SA MNC"];
    document.getElementById("nr5g-sa-cellid").innerText = data["NR5G-SA Cell ID"];
    document.getElementById("nr5g-sa-deccellid").innerText = data["NR5G-SA Cell ID (Dec)"];
    document.getElementById("pcc").innerText = data["PCC"];

    updateProgressBar("signal-progress", data["Signal Strength"],0,99);
    updateProgressBar("rssi-progress", data["RSSI"],-110,-50);
    updateProgressBar("lte-rsrq-progress", data["LTE RSRQ"],-20,3);
    updateProgressBar("lte-rsrp-progress", data["LTE RSRP"],-140,-44);
    updateProgressBar("lte-sinr-progress", data["LTE SINR"],-20,30);

    updateProgressBar("nr5g-nsa-rsrq", data["NR5G-NSA RSRQ"],-20,3);
    updateProgressBar("nr5g-nsa-rsrp", data["NR5G-NSA RSRP"],-140,-44);
    updateProgressBar("nr5g-nsa-sinr", data["NR5G-NSA SINR"],-20,30);

    updateProgressBar("nr5g-sa-rsrq", data["NR5G-SA RSRQ"],-20,3);
    updateProgressBar("nr5g-sa-rsrp", data["NR5G-SA RSRP"],-140,-44);
    updateProgressBar("nr5g-sa-sinr", data["NR5G-SA SINR"],-20,30);
  });
}
setInterval(updateModemInfo, <%=refresh_rate%>*1000);
updateModemInfo();
</script>

<%+footer%>
